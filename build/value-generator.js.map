{
  "version": 3,
  "sources": ["../src/value-generator.ts"],
  "sourcesContent": ["import { commonValueGenerators } from './value-generator.defs';\n\nconst getValueGeneratorRelevance = (vg: ioBroker.ValueGeneratorDefinition): number => {\n\tlet result = 0;\n\tif (vg.u !== '%%CUSTOM%%' && vg.u !== '%%TYPE_MATCH%%') {\n\t\tresult += 2;\n\t}\n\n\tif (vg.d) {\n\t\tresult += 3;\n\t}\n\n\tif (vg.s) {\n\t\tresult += 1;\n\t}\n\treturn result;\n};\n\nexport const getValueGenerator = (\n\tstateDefinition: ioBroker.DeviceStateDefinition,\n): ioBroker.ValueGenerator<ioBroker.StateValue> | undefined => {\n\tconst logFallback = (sd: ioBroker.DeviceStateDefinition, vg: ioBroker.ValueGeneratorDefinition): void => {\n\t\tif (!vg.isFallback) {\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(`Warning: Fallback used for ${sd.device.name}:${sd.state.name} (${sd.commonType}).`);\n\t};\n\n\tconst exactGeneratorMatches = commonValueGenerators.filter(\n\t\tvgDef =>\n\t\t\tvgDef.u === stateDefinition.state.defaultUnit &&\n\t\t\tvgDef.t === stateDefinition.commonType &&\n\t\t\t(vgDef.d === undefined || vgDef.d.includes(stateDefinition.device.name)) &&\n\t\t\t(vgDef.s === undefined || vgDef.s.includes(stateDefinition.state.name)),\n\t);\n\n\tif (exactGeneratorMatches.length === 1) {\n\t\tlogFallback(stateDefinition, exactGeneratorMatches[0]);\n\t\treturn exactGeneratorMatches[0].gen;\n\t} else if (exactGeneratorMatches.length > 1) {\n\t\tconst genWithHighestSpecification = exactGeneratorMatches.sort(\n\t\t\t(a, b) => getValueGeneratorRelevance(b) - getValueGeneratorRelevance(a),\n\t\t);\n\n\t\treturn genWithHighestSpecification[0].gen;\n\t}\n\n\tconst customMatches = commonValueGenerators.filter(\n\t\tvgDef =>\n\t\t\tvgDef.u === '%%CUSTOM%%' &&\n\t\t\tvgDef.t === stateDefinition.commonType &&\n\t\t\t(vgDef.d === undefined || vgDef.d.includes(stateDefinition.device.name)) &&\n\t\t\t(vgDef.s === undefined || vgDef.s.includes(stateDefinition.state.name)),\n\t);\n\n\tif (customMatches.length === 1) {\n\t\tlogFallback(stateDefinition, customMatches[0]);\n\t\treturn customMatches[0].gen;\n\t}\n\n\tconst typeMatches = commonValueGenerators.filter(\n\t\tvgDef => vgDef.u === '%%TYPE_MATCH%%' && vgDef.t === stateDefinition.commonType,\n\t);\n\n\tif (typeMatches.length === 1) {\n\t\tlogFallback(stateDefinition, typeMatches[0]);\n\t\treturn typeMatches[0].gen;\n\t}\n\n\treturn undefined;\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAsC;AAEtC,MAAM,6BAA6B,CAAC,OAAkD;AACrF,MAAI,SAAS;AACb,MAAI,GAAG,MAAM,gBAAgB,GAAG,MAAM,kBAAkB;AACvD,cAAU;AAAA,EACX;AAEA,MAAI,GAAG,GAAG;AACT,cAAU;AAAA,EACX;AAEA,MAAI,GAAG,GAAG;AACT,cAAU;AAAA,EACX;AACA,SAAO;AACR;AAEO,MAAM,oBAAoB,CAChC,oBAC8D;AAC9D,QAAM,cAAc,CAAC,IAAoC,OAAgD;AACxG,QAAI,CAAC,GAAG,YAAY;AACnB;AAAA,IACD;AACA,YAAQ,IAAI,8BAA8B,GAAG,OAAO,IAAI,IAAI,GAAG,MAAM,IAAI,KAAK,GAAG,UAAU,IAAI;AAAA,EAChG;AAEA,QAAM,wBAAwB,6CAAsB;AAAA,IACnD,WACC,MAAM,MAAM,gBAAgB,MAAM,eAClC,MAAM,MAAM,gBAAgB,eAC3B,MAAM,MAAM,UAAa,MAAM,EAAE,SAAS,gBAAgB,OAAO,IAAI,OACrE,MAAM,MAAM,UAAa,MAAM,EAAE,SAAS,gBAAgB,MAAM,IAAI;AAAA,EACvE;AAEA,MAAI,sBAAsB,WAAW,GAAG;AACvC,gBAAY,iBAAiB,sBAAsB,CAAC,CAAC;AACrD,WAAO,sBAAsB,CAAC,EAAE;AAAA,EACjC,WAAW,sBAAsB,SAAS,GAAG;AAC5C,UAAM,8BAA8B,sBAAsB;AAAA,MACzD,CAAC,GAAG,MAAM,2BAA2B,CAAC,IAAI,2BAA2B,CAAC;AAAA,IACvE;AAEA,WAAO,4BAA4B,CAAC,EAAE;AAAA,EACvC;AAEA,QAAM,gBAAgB,6CAAsB;AAAA,IAC3C,WACC,MAAM,MAAM,gBACZ,MAAM,MAAM,gBAAgB,eAC3B,MAAM,MAAM,UAAa,MAAM,EAAE,SAAS,gBAAgB,OAAO,IAAI,OACrE,MAAM,MAAM,UAAa,MAAM,EAAE,SAAS,gBAAgB,MAAM,IAAI;AAAA,EACvE;AAEA,MAAI,cAAc,WAAW,GAAG;AAC/B,gBAAY,iBAAiB,cAAc,CAAC,CAAC;AAC7C,WAAO,cAAc,CAAC,EAAE;AAAA,EACzB;AAEA,QAAM,cAAc,6CAAsB;AAAA,IACzC,WAAS,MAAM,MAAM,oBAAoB,MAAM,MAAM,gBAAgB;AAAA,EACtE;AAEA,MAAI,YAAY,WAAW,GAAG;AAC7B,gBAAY,iBAAiB,YAAY,CAAC,CAAC;AAC3C,WAAO,YAAY,CAAC,EAAE;AAAA,EACvB;AAEA,SAAO;AACR;",
  "names": []
}
