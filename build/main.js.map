{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from '@iobroker/adapter-core';\nimport ChannelDetector, { type DetectOptions, type ExternalDetectorState, type Types } from '@iobroker/type-detector';\n\ntype DeviceDefinition = {\n\tstates: ExternalDetectorState[];\n\ttype: Types;\n\tenumRequired?: boolean;\n\tname: string;\n};\n\ntype StateWithDeviceRef = ExternalDetectorState & {\n\tdeviceRef: DeviceDefinition;\n};\n\n// Not used for now; May be handy in the future.\ninterface DeviceFilterContext {\n\tdevice: DeviceDefinition;\n}\n\ninterface DeviceStateDefinition {\n\tstate: ExternalDetectorState;\n\tstateFqn: string;\n\tcontext: DeviceFilterContext;\n\tdeviceType: string;\n\tdeviceRoot: string;\n\tgenerationType: DeviceStatesGenerationType;\n\tdevice: DeviceDefinition;\n\tcommonType: ioBroker.CommonType;\n}\n\ntype DeviceStatesGenerationType = 'all' | 'required';\n\n// Heck, I can't get typescript to enfoce that the array here consists of all properties of the type.\n// If a new type is introduced one line above, it must be added here too :/\nconst generationTypes: GenerationTypes = ['all', 'required'];\n\ntype GenerationTypes = readonly DeviceStatesGenerationType[];\n\ntype DeviceFilterType = Record<\n\tDeviceStatesGenerationType,\n\t(ctx: DeviceFilterContext, state: ExternalDetectorState) => boolean\n>;\n\nconst deviceFilter: DeviceFilterType = {\n\tall: (_1, _2) => true,\n\trequired: (_, s) => !!s.required,\n};\n\nconst detector: ChannelDetector = new ChannelDetector();\n\nconst deviceTypeBlacklist: string[] = ['chart'];\n\nconst getDeviceMetadata: () => DeviceDefinition[] = () => {\n\tconst knownPatterns = ChannelDetector.getPatterns();\n\n\treturn Object.entries(knownPatterns)\n\t\t.filter(([k, _]) => !deviceTypeBlacklist.includes(k))\n\t\t.map(([k, v]) => ({\n\t\t\t...v,\n\t\t\tstates: v.states.filter(s => !!s.defaultRole),\n\t\t\tname: k,\n\t\t}));\n};\n\nconst getStateType = (state: ExternalDetectorState, fallback?: ioBroker.CommonType): ioBroker.CommonType => {\n\treturn Array.isArray(state.type) ? state.type[0] : (state.type ?? fallback ?? 'string');\n};\n\nconst crossProduct = <A, B>(as: readonly A[], bs: readonly B[]): Array<readonly [A, B]> => {\n\tconst result: Array<readonly [A, B]> = [];\n\tfor (const a of as) {\n\t\tfor (const b of bs) {\n\t\t\tresult.push([a, b] as const);\n\t\t}\n\t}\n\treturn result;\n};\n\nconst printMissingDefaultRoleMarkdown = (states: StateWithDeviceRef[]): void => {\n\tconst sortedStates = [...states] // Assuming sort is stable.\n\t\t.sort((a, b) => a.name.localeCompare(b.name))\n\t\t.sort((a, b) => a.deviceRef.name.localeCompare(b.deviceRef.name));\n\n\tlet output = '| Device | Name | Type | Role Regex |\\n';\n\toutput += '| - | - | - | - |\\n';\n\n\t/*                                                                                   *caugh* */\n\tfor (const state of sortedStates) {\n\t\toutput += `| ${state.deviceRef.name} | ${state.name} | ${getStateType(state, 'N/A' as any)} | \\`${state.role}\\` |\\n`;\n\t}\n\n\tconsole.log(output);\n};\n\nclass TestDevices extends utils.Adapter {\n\tprivate static deviceFolderName: string = 'devices';\n\tprivate static triggerFolderName: string = 'triggers';\n\n\tprivate readonly validDevices: DeviceDefinition[];\n\tprivate readonly stateLookup: Record<string, DeviceStateDefinition>;\n\n\tprivate readonly stateNames: string[] = [];\n\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\tname: 'test-devices',\n\t\t});\n\t\tthis.on('message', this.onMessage.bind(this));\n\t\tthis.on('ready', this.onReady.bind(this));\n\t\tthis.on('unload', this.onUnload.bind(this));\n\n\t\tconst startMs = Date.now();\n\t\tconst allDevices = getDeviceMetadata();\n\n\t\tthis.analyzeAllStates(allDevices);\n\n\t\tconst deviceNamesWithMissingDefaultRoles = this.getDeviceNamesMissingDefaultRoles(allDevices);\n\t\tthis.analyzeDuplicateDefaultRoles(allDevices);\n\n\t\tthis.validDevices = allDevices.filter(d => !deviceNamesWithMissingDefaultRoles.includes(d.name));\n\n\t\tthis.stateLookup = this.createDesiredStateDefinitions(this.validDevices);\n\t\tthis.stateNames = Object.keys(this.stateLookup);\n\n\t\tthis.logLater(`Discovering desired states took ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate createDesiredStateDefinitions(validDevices: DeviceDefinition[]): Record<string, DeviceStateDefinition> {\n\t\tconst getDeviceType = (genType: DeviceStatesGenerationType): string =>\n\t\t\t`${this.namespace}.${TestDevices.GetDeviceFolderName()}.${genType}`;\n\t\tconst getDeviceRoot = (genType: DeviceStatesGenerationType, device: DeviceDefinition): string =>\n\t\t\t`${getDeviceType(genType)}.${device.name}`;\n\n\t\t// 'NoOp' for now\n\t\tconst getFilterContext = (device: DeviceDefinition): DeviceFilterContext => {\n\t\t\treturn { device };\n\t\t};\n\n\t\tconst stateCacheMemory: DeviceStateDefinition[] = crossProduct(generationTypes, validDevices)\n\t\t\t.map(arr => ({\n\t\t\t\tgenerationType: arr[0],\n\t\t\t\tdevice: arr[1],\n\t\t\t}))\n\t\t\t.map(m => ({\n\t\t\t\t...m,\n\t\t\t\tcontext: getFilterContext(m.device),\n\t\t\t\tdeviceType: getDeviceType(m.generationType),\n\t\t\t\tdeviceRoot: getDeviceRoot(m.generationType, m.device),\n\t\t\t}))\n\t\t\t.map(m =>\n\t\t\t\tm.device.states\n\t\t\t\t\t.filter(s => deviceFilter[m.generationType](m.context, s))\n\t\t\t\t\t.map(s => ({ ...m, state: s, stateFqn: `${m.deviceRoot}.${s.name}`, commonType: getStateType(s) })),\n\t\t\t)\n\t\t\t.reduce((prev, curr) => [...prev, ...curr], []);\n\n\t\treturn stateCacheMemory.reduce((prev, curr) => ({ ...prev, [curr.stateFqn]: curr }), {});\n\t}\n\n\tpublic static GetDeviceFolderName(): string {\n\t\treturn TestDevices.deviceFolderName;\n\t}\n\n\tpublic static GetTriggerFolderName(): string {\n\t\treturn TestDevices.triggerFolderName;\n\t}\n\n\tprivate async onReady(): Promise<void> {\n\t\tfor (const msg of this.logMessages) {\n\t\t\tthis.log.info(msg);\n\t\t}\n\t\tthis.logMessages = [];\n\n\t\tconst startMs = Date.now();\n\n\t\tconst objectCache = await this.getObjectsCachedAsync();\n\n\t\tawait this.createTopLevelFoldersAsync();\n\t\tawait this.createDeviceChangeTriggersAsync(this.validDevices);\n\t\tawait this.createMetaStatesForDevicesAsync(this.validDevices);\n\n\t\tconst foundInDb = Object.keys(objectCache);\n\t\tif (this.stateNames.every(requestedDeviceStateName => foundInDb.includes(requestedDeviceStateName))) {\n\t\t\tthis.log.debug(\n\t\t\t\t`Device states unchanged from last start. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Skipping creation.`,\n\t\t\t);\n\t\t} else {\n\t\t\tthis.log.debug(\n\t\t\t\t`Actual device states deviate from desired state. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Recreating all.`,\n\t\t\t);\n\t\t\tawait this.createAllDevicesAsync(this.validDevices);\n\t\t}\n\n\t\tthis.log.info(`Stored state count: ${this.stateNames.length}.`);\n\n\t\tthis.setConnected(true);\n\t\tthis.log.info(`Start-up finished within ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate readonly validCommands: string[] = ['VERIFY_DEVICE_TYPE', 'GET_DEVICE_STATES'];\n\n\tprivate async onMessage(message: ioBroker.Message): Promise<void> {\n\t\tif (!this.validCommands.includes(message.command) || !message.callback) {\n\t\t\tthis.log.info(`Dropping unknown command '${message.command}'.`);\n\t\t\tthis.sendTo(message.from, message.command, 'INVALID_COMMAND', message.callback);\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.command === 'VERIFY_DEVICE_TYPE') {\n\t\t\tconst deviceType = message.message as string;\n\t\t\tconst result = await this.verifyCreatedDeviceAsync(deviceType);\n\t\t\tthis.sendTo(message.from, message.command, result ? 'SUCCESS' : 'FAIL', message.callback);\n\t\t} else if (message.command === 'GET_DEVICE_STATES') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t\tthis.sendTo(message.from, message.command, this.stateNames, message.callback);\n\t\t} else if (message.command === 'SIMULATE_SINGLE_DEVICE_CHANGE') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t} else if (message.command === 'SIMULATE_DEVICE_CHANGES') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t}\n\t}\n\n\tprivate async createTopLevelFoldersAsync(): Promise<void> {\n\t\tconst fqFolderName = `${this.namespace}.${TestDevices.GetDeviceFolderName()}`;\n\t\tconst fqTriggerName = `${this.namespace}.${TestDevices.GetTriggerFolderName()}`;\n\n\t\tawait Promise.allSettled([\n\t\t\tthis.extendObject(fqTriggerName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqTriggerName,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tthis.extendObject(fqFolderName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqFolderName,\n\t\t\t\t},\n\t\t\t}),\n\t\t]);\n\t}\n\n\tprivate async createAllDevicesAsync(validDevices: DeviceDefinition[]): Promise<void> {\n\t\tconst startMs = Date.now();\n\t\tthis.log.debug(`Creating ${this.stateNames.length} states for ${validDevices.length} devices`);\n\t\tconst sem = new Semaphore(16);\n\n\t\tconst allPromises = Object.values(this.stateLookup).map(stateDef =>\n\t\t\tsem.with(() =>\n\t\t\t\tthis.extendObject(stateDef.stateFqn, {\n\t\t\t\t\ttype: 'state',\n\t\t\t\t\tcommon: {\n\t\t\t\t\t\tname: stateDef.state.name,\n\t\t\t\t\t\ttype: stateDef.commonType,\n\t\t\t\t\t\tread: stateDef.state.read ?? true,\n\t\t\t\t\t\twrite: stateDef.state.write ?? false,\n\t\t\t\t\t\trole: stateDef.state.defaultRole,\n\t\t\t\t\t\tunit: stateDef.state.defaultUnit,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\n\t\tawait Promise.all(allPromises);\n\t\tthis.log.info(\n\t\t\t`Created ${this.stateNames.length} states for ${validDevices.length} devices in ${Date.now() - startMs}ms.`,\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDevicesAsync(devices: DeviceDefinition[]): Promise<void> {\n\t\tawait Promise.all(\n\t\t\tcrossProduct(generationTypes, devices).map(d => this.createMetaStatesForDeviceAsync(d[1], d[0])),\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDeviceAsync(\n\t\tdevice: DeviceDefinition,\n\t\tprefix: DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${TestDevices.GetDeviceFolderName()}.${prefix}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'device',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\n\t\tconst deviceRoot = `${deviceType}.${device.name}`;\n\t\tawait this.extendObject(deviceRoot, {\n\t\t\ttype: 'channel',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate async createDeviceChangeTriggersAsync(validDevices: DeviceDefinition[]): Promise<void> {\n\t\tthis.log.debug(`Creating triggers for ${validDevices.length} devices`);\n\n\t\tconst startMs = Date.now();\n\t\tconst triggerFolder = `${this.namespace}.${TestDevices.GetTriggerFolderName()}`;\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tawait this.extendObject(`${triggerFolder}.${generationType}`, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: generationType,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tfor (const device of validDevices) {\n\t\t\t\tawait this.createOrUpdateSingleDeviceTriggerAsync(\n\t\t\t\t\tdevice,\n\t\t\t\t\tTestDevices.GetTriggerFolderName(),\n\t\t\t\t\tgenerationType,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.info(`Done. Created ${validDevices.length} device triggers in ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate async createOrUpdateSingleDeviceTriggerAsync(\n\t\tdevice: DeviceDefinition,\n\t\tfolderName: string,\n\t\tprefix: DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${folderName}.${prefix}.${device.name}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'state',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t\ttype: 'boolean',\n\t\t\t\trole: 'button',\n\t\t\t\tread: false,\n\t\t\t\twrite: true,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate objectsLastRead: number | null = null;\n\tprivate objectCache: Record<string, ioBroker.Object> | null = null;\n\n\tprivate async getObjectsCachedAsync(): Promise<Record<string, ioBroker.Object>> {\n\t\tif (this.objectCache && this.objectsLastRead && Date.now() - this.objectsLastRead < 60 * 1000) {\n\t\t\treturn this.objectCache;\n\t\t}\n\n\t\tthis.objectsLastRead = Date.now();\n\t\tthis.objectCache = await this.getForeignObjects(`${this.namespace}.${TestDevices.GetDeviceFolderName()}.*`);\n\n\t\tthis.log.debug(\n\t\t\t`Read ${Object.keys(this.objectCache).length} objects in ${Date.now() - this.objectsLastRead}ms.`,\n\t\t);\n\n\t\treturn this.objectCache;\n\t}\n\n\tprivate async verifyCreatedDeviceAsync(deviceType: string): Promise<boolean> {\n\t\tconst objects = await this.getObjectsCachedAsync();\n\n\t\tconst deviceGenerationTypes: DeviceStatesGenerationType[] = ['all', 'required'];\n\n\t\tlet result = true;\n\t\tfor (const generationType of deviceGenerationTypes) {\n\t\t\tconst prefix = `${this.namespace}.${TestDevices.GetDeviceFolderName()}.${generationType}`;\n\n\t\t\tconst expectedId = `${prefix}.${deviceType}`;\n\n\t\t\tconst options: DetectOptions = {\n\t\t\t\tobjects: objects,\n\t\t\t\tid: expectedId,\n\t\t\t};\n\n\t\t\tconst controls = detector.detect(options);\n\n\t\t\tif (!controls) {\n\t\t\t\tthis.log.debug(`No matches found for ${options.id}`);\n\t\t\t\tresult = false;\n\t\t\t} else if (controls && controls.length > 1) {\n\t\t\t\tconst foundDeviceTypes = controls.map(c => c.type).join(', ');\n\t\t\t\tif (foundDeviceTypes.includes(deviceType)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.log.debug(\n\t\t\t\t\t`Too many matches found for ${options.id}, but none of them matches expected type '${deviceType}': [${foundDeviceTypes}]`,\n\t\t\t\t);\n\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate onUnload(callback: () => void): void {\n\t\ttry {\n\t\t\tthis.setConnected(false);\n\t\t} catch (error) {\n\t\t\tthis.log.error(`Error during unloading: ${(error as Error).message}`);\n\t\t} finally {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tprivate logMessages: string[] = [];\n\tprivate logLater(message: string): void {\n\t\tthis.logMessages.push(message);\n\t}\n\n\tprivate analyzeAllStates(allDevices: DeviceDefinition[]): void {\n\t\tconst mapState: (device: DeviceDefinition, state: ExternalDetectorState) => StateWithDeviceRef = (\n\t\t\tdevice,\n\t\t\tstate,\n\t\t) => ({ ...state, deviceRef: device });\n\n\t\tconst allStates = allDevices.reduce(\n\t\t\t(prev: StateWithDeviceRef[], curr) => [...prev, ...curr.states.map(s => mapState(curr, s))],\n\t\t\t[],\n\t\t);\n\n\t\tthis.logLater(`State count total: ${allStates.length}`);\n\n\t\tconst statesWithoutDefaultRole = allStates.filter(s => !s.defaultRole);\n\n\t\tif (statesWithoutDefaultRole.length > 0) {\n\t\t\tthis.logLater(\n\t\t\t\t`States without default role: ${statesWithoutDefaultRole.length} - [${statesWithoutDefaultRole.map(s => s.name).join(', ')}]`,\n\t\t\t);\n\n\t\t\tprintMissingDefaultRoleMarkdown(statesWithoutDefaultRole);\n\t\t}\n\t}\n\n\tprivate analyzeDuplicateDefaultRoles(allDevices: DeviceDefinition[]): void {\n\t\tconst isDuplicatedDefaultRole = (state: ExternalDetectorState, allStates: ExternalDetectorState[]): boolean => {\n\t\t\treturn allStates.filter(sInner => sInner.defaultRole == state.defaultRole).length > 1;\n\t\t};\n\n\t\tconst devicesWithDuplicateDefaultRoles = allDevices.filter(\n\t\t\td => d.states.filter(s => isDuplicatedDefaultRole(s, d.states)).length > 0,\n\t\t);\n\n\t\tif (devicesWithDuplicateDefaultRoles.length > 0) {\n\t\t\tconst deviceNamesWithDuplicateDefaultRoles = devicesWithDuplicateDefaultRoles.map(d => d.name);\n\t\t\tthis.logLater(\n\t\t\t\t`Found ${devicesWithDuplicateDefaultRoles.length} devices with duplicate default roles: [${deviceNamesWithDuplicateDefaultRoles.join(\n\t\t\t\t\t', ',\n\t\t\t\t)}] A state will be generated for each, ignoring the duplication.`,\n\t\t\t);\n\n\t\t\tfor (const device of devicesWithDuplicateDefaultRoles) {\n\t\t\t\tconst duplicatedDefaultRoles = device.states\n\t\t\t\t\t.filter(s => isDuplicatedDefaultRole(s, device.states))\n\t\t\t\t\t.map(s => `${s.name} -> ${s.defaultRole}`);\n\n\t\t\t\tthis.logLater(`\\t${device.name} -> Duplicate Roles: ${duplicatedDefaultRoles.join(', ')}`);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getDeviceNamesMissingDefaultRoles(allDevices: DeviceDefinition[]): string[] {\n\t\tconst devicesWithMissingDefaultRoles = allDevices.filter(\n\t\t\td => d.states.filter(s => s.required && !s.defaultRole).length > 0,\n\t\t);\n\n\t\tconst deviceNamesWithMissingDefaultRoles = devicesWithMissingDefaultRoles.map(d => d.name);\n\n\t\tif (devicesWithMissingDefaultRoles.length > 0) {\n\t\t\tthis.logLater(\n\t\t\t\t`Found ${devicesWithMissingDefaultRoles.length} devices with missing default roles: [${deviceNamesWithMissingDefaultRoles.join(\n\t\t\t\t\t', ',\n\t\t\t\t)}] These will be skipped.`,\n\t\t\t);\n\t\t}\n\n\t\treturn deviceNamesWithMissingDefaultRoles;\n\t}\n\n\tprivate setConnected(isConnected: boolean): void {\n\t\tvoid this.setState('info.connection', isConnected, true, error =>\n\t\t\t// analyse if the state could be set (because of permissions)\n\t\t\terror\n\t\t\t\t? this.log.error(`Can not update this._connected state: ${error}`)\n\t\t\t\t: this.log.debug(`connected set to ${isConnected}`),\n\t\t);\n\t}\n}\n\nclass Semaphore {\n\tprivate count: number;\n\tprivate queue: Array<() => void> = [];\n\n\tconstructor(maxConcurrency: number) {\n\t\tthis.count = maxConcurrency;\n\t}\n\n\tasync acquire(): Promise<void> {\n\t\tif (this.count > 0) {\n\t\t\tthis.count--;\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.queue.push(resolve);\n\t\t});\n\t}\n\n\trelease(): void {\n\t\tif (this.queue.length > 0) {\n\t\t\tconst next = this.queue.shift()!;\n\t\t\tnext();\n\t\t} else {\n\t\t\tthis.count++;\n\t\t}\n\t}\n\n\t// Convenience method\n\tasync with<T>(fn: () => Promise<T>): Promise<T> {\n\t\tawait this.acquire();\n\t\ttry {\n\t\t\treturn await fn();\n\t\t} finally {\n\t\t\tthis.release();\n\t\t}\n\t}\n}\n\nif (require.main !== module) {\n\t// Export the constructor in compact mode\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new TestDevices(options);\n} else {\n\t// otherwise start the instance directly\n\t(() => new TestDevices())();\n}\n"],
  "mappings": "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",
  "names": ["ChannelDetector"]
}
