{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from '@iobroker/adapter-core';\nimport ChannelDetector, { type DetectOptions, type ExternalDetectorState } from '@iobroker/type-detector';\nimport { getDeviceMetadata } from './device-metadata';\nimport { crossProduct, parseGenerationType, printMissingDefaultRoleMarkdown } from './utils';\nimport { createDesiredStateDefinitions } from './state-definitions';\nimport { generationTypes, GetDeviceFolderName, GetTriggerFolderName } from './constants';\nimport { getFallbackValueGenerator } from './value-generators';\n\nconst detector: ChannelDetector = new ChannelDetector();\n\nclass TestDevices extends utils.Adapter {\n\tprivate readonly validDevices: ioBroker.DeviceDefinition[];\n\tprivate readonly stateLookup: Record<string, ioBroker.DeviceStateDefinition>;\n\n\tprivate readonly stateNames: string[] = [];\n\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\tname: 'test-devices',\n\t\t});\n\t\tthis.on('message', this.onMessage.bind(this));\n\t\tthis.on('ready', this.onReady.bind(this));\n\t\tthis.on('stateChange', this.onStateChange.bind(this));\n\t\tthis.on('unload', this.onUnload.bind(this));\n\n\t\tconst startMs = Date.now();\n\t\tthis.validDevices = getDeviceMetadata(this.logLater);\n\n\t\tthis.analyzeAllStates(this.validDevices);\n\t\tthis.analyzeDuplicateDefaultRoles(this.validDevices);\n\n\t\tthis.stateLookup = createDesiredStateDefinitions(this.namespace, this.config, this.validDevices);\n\t\tthis.stateNames = Object.keys(this.stateLookup);\n\n\t\tthis.logLater(`Discovering desired states took ${Date.now() - startMs}ms.`);\n\n\t\tconst triggerChangeRegex = `^${this.namespace.replace('.', '\\\\.')}\\\\.${GetTriggerFolderName()}\\\\.((${generationTypes.join('|')})\\\\.([^\\\\.]*))$`;\n\t\tthis.logLater(`Constructed trigger change regex: ${triggerChangeRegex}`);\n\n\t\tconst deviceChangeRegex = `^${this.namespace}\\\\.${GetDeviceFolderName()}\\\\.(${generationTypes.join('|')})\\\\.([^\\\\.]*)\\\\.([^\\\\.]*)$`;\n\t\tthis.logLater(`Constructed device change regex: ${deviceChangeRegex}`);\n\n\t\tthis.triggerChangeRegex = new RegExp(triggerChangeRegex);\n\t\tthis.deviceStateChangeRegex = new RegExp(deviceChangeRegex);\n\t}\n\n\tprivate async onReady(): Promise<void> {\n\t\tfor (const msg of this.logMessages) {\n\t\t\tthis.log.info(msg);\n\t\t}\n\t\tthis.logMessages = [];\n\n\t\tconst startMs = Date.now();\n\n\t\tconst objectCache = await this.getObjectsCachedAsync();\n\n\t\tawait this.createTopLevelFoldersAsync();\n\t\tawait this.createDeviceChangeTriggersAsync(this.validDevices);\n\t\tawait this.createMetaStatesForDevicesAsync(this.validDevices);\n\n\t\tconst foundInDb = Object.keys(objectCache);\n\t\tif (this.stateNames.every(requestedDeviceStateName => foundInDb.includes(requestedDeviceStateName))) {\n\t\t\tthis.log.debug(\n\t\t\t\t`Device states unchanged from last start. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Skipping creation.`,\n\t\t\t);\n\t\t} else {\n\t\t\tthis.log.debug(\n\t\t\t\t`Actual device states deviate from desired state. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Recreating all.`,\n\t\t\t);\n\t\t\tawait this.createAllDevicesAsync(this.validDevices);\n\t\t\tthis.objectCache = null; // Force cache reload for good measure\n\t\t\tvoid this.getObjectsCachedAsync();\n\t\t}\n\n\t\tthis.log.info(`Stored state count: ${this.stateNames.length}.`);\n\n\t\tthis.subscribeStates(`${this.namespace}.*`);\n\n\t\tif (this.config.acknowledgeStatesOnStart) {\n\t\t\tawait this.updateAllStates();\n\t\t}\n\n\t\tthis.setConnected(true);\n\t\tthis.log.info(`Start-up finished within ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate readonly validCommands: string[] = [\n\t\t'VERIFY_DEVICE_TYPE',\n\t\t'GET_DEVICE_STATES',\n\t\t'SIMULATE_DEVICE_CHANGES',\n\t\t'SIMULATE_SINGLE_DEVICE_CHANGE',\n\t];\n\n\tprivate readonly triggerChangeRegex: RegExp;\n\tprivate readonly deviceStateChangeRegex: RegExp;\n\n\tprivate async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n\t\tif (!state || state.ack) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.triggerChangeRegex.test(id)) {\n\t\t\tconst startMs = Date.now();\n\t\t\tconst match = this.triggerChangeRegex.exec(id);\n\t\t\tif (!match || match.length < 4) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst genType = parseGenerationType(match[2]);\n\t\t\tconst device = match[3];\n\t\t\tif (!genType) {\n\t\t\t\tthis.log.warn(`Unknown generation type: '${match[2]}'. Refusing to process trigger.`);\n\t\t\t\treturn; // I guess it's fine to not ACK this?!\n\t\t\t}\n\n\t\t\tthis.log.debug(`Received trigger for ${id} -> ${genType}:${device}.`);\n\n\t\t\tawait this.simulateSingleDeviceStatesAsync(genType, device);\n\t\t\t//                               v ACK\n\t\t\tawait this.setState(id, state, true);\n\t\t\tthis.log.debug(`Trigger processed in ${Date.now() - startMs}ms.`);\n\t\t}\n\n\t\tif (this.deviceStateChangeRegex.test(id)) {\n\t\t\tthis.log.debug(`Received state change for device ${id}.`);\n\t\t\tawait this.setState(id, state, true);\n\t\t}\n\t}\n\n\tprivate async onMessage(message: ioBroker.Message): Promise<void> {\n\t\tif (!this.validCommands.includes(message.command) || !message.callback) {\n\t\t\tthis.log.info(`Dropping unknown command '${message.command}'.`);\n\t\t\tthis.sendTo(message.from, message.command, 'INVALID_COMMAND', message.callback);\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.command === 'VERIFY_DEVICE_TYPE') {\n\t\t\tconst deviceType = message.message as string;\n\t\t\tconst result = await this.verifyCreatedDeviceAsync(deviceType);\n\t\t\tthis.sendTo(message.from, message.command, result ? 'SUCCESS' : 'FAIL', message.callback);\n\t\t} else if (message.command === 'GET_DEVICE_STATES') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t\tthis.sendTo(message.from, message.command, this.stateNames, message.callback);\n\t\t} else if (message.command === 'SIMULATE_DEVICE_CHANGES') {\n\t\t\tawait this.updateAllStates();\n\t\t\tthis.sendTo(message.from, message.command, 'SUCCESS', message.callback);\n\t\t} else if (message.command === 'SIMULATE_SINGLE_DEVICE_CHANGE') {\n\t\t\tconst generationTypeUntyped = message.message.generationType;\n\t\t\tconst deviceName = message.message.device;\n\n\t\t\tconst sendInvalidPayloadResponse = (msg: string): void =>\n\t\t\t\tthis.sendTo(message.from, message.command, `INVALID_PAYLOAD:${msg}`, message.callback);\n\n\t\t\tif (!generationTypeUntyped || typeof generationTypeUntyped !== 'string') {\n\t\t\t\tsendInvalidPayloadResponse(\n\t\t\t\t\t`Expected property 'generationType' to be one of [${generationTypes.join(', ')}].`,\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst generationType = parseGenerationType(generationTypeUntyped);\n\t\t\tif (!generationType) {\n\t\t\t\tsendInvalidPayloadResponse(\n\t\t\t\t\t`Expected property 'generationType' to be one of [${generationTypes.join(', ')}].`,\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!deviceName || typeof deviceName !== 'string') {\n\t\t\t\tsendInvalidPayloadResponse(`Expected property 'device' to be a simple string.`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.simulateSingleDeviceStatesAsync(generationType, deviceName);\n\t\t\tthis.sendTo(message.from, message.command, 'SUCCESS', message.callback);\n\t\t}\n\t}\n\n\tprivate async createTopLevelFoldersAsync(): Promise<void> {\n\t\tconst fqFolderName = `${this.namespace}.${GetDeviceFolderName()}`;\n\t\tconst fqTriggerName = `${this.namespace}.${GetTriggerFolderName()}`;\n\n\t\tawait Promise.allSettled([\n\t\t\tthis.extendObject(fqTriggerName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqTriggerName,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tthis.extendObject(fqFolderName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqFolderName,\n\t\t\t\t},\n\t\t\t}),\n\t\t]);\n\t}\n\n\tprivate async createAllDevicesAsync(validDevices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tconst startMs = Date.now();\n\t\tthis.log.debug(`Creating ${this.stateNames.length} states for ${validDevices.length} devices`);\n\t\tconst sem = new Semaphore(16);\n\n\t\tconst allPromises = Object.values(this.stateLookup).map(stateDef =>\n\t\t\tsem.with(() =>\n\t\t\t\tthis.extendObject(stateDef.stateFqn, {\n\t\t\t\t\ttype: 'state',\n\t\t\t\t\tcommon: {\n\t\t\t\t\t\tname: stateDef.state.name,\n\t\t\t\t\t\ttype: stateDef.commonType,\n\t\t\t\t\t\tread: stateDef.read,\n\t\t\t\t\t\twrite: stateDef.write,\n\t\t\t\t\t\trole: stateDef.state.defaultRole,\n\t\t\t\t\t\tunit: stateDef.state.defaultUnit,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\n\t\tawait Promise.all(allPromises);\n\t\tthis.log.info(\n\t\t\t`Created ${this.stateNames.length} states for ${validDevices.length} devices in ${Date.now() - startMs}ms.`,\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDevicesAsync(devices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tawait Promise.all(\n\t\t\tcrossProduct(generationTypes, devices).map(d => this.createMetaStatesForDeviceAsync(d[1], d[0])),\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDeviceAsync(\n\t\tdevice: ioBroker.DeviceDefinition,\n\t\tprefix: ioBroker.DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${GetDeviceFolderName()}.${prefix}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'device',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\n\t\tconst deviceRoot = `${deviceType}.${device.name}`;\n\t\tawait this.extendObject(deviceRoot, {\n\t\t\ttype: 'channel',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate async createDeviceChangeTriggersAsync(validDevices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tthis.log.debug(`Creating triggers for ${validDevices.length} devices`);\n\n\t\tconst startMs = Date.now();\n\t\tconst triggerFolder = `${this.namespace}.${GetTriggerFolderName()}`;\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tawait this.extendObject(`${triggerFolder}.${generationType}`, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: generationType,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tfor (const device of validDevices) {\n\t\t\t\tawait this.createOrUpdateSingleDeviceTriggerAsync(device, GetTriggerFolderName(), generationType);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.info(`Done. Created ${validDevices.length} device triggers in ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate async createOrUpdateSingleDeviceTriggerAsync(\n\t\tdevice: ioBroker.DeviceDefinition,\n\t\tfolderName: string,\n\t\tprefix: ioBroker.DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${folderName}.${prefix}.${device.name}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'state',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t\ttype: 'boolean',\n\t\t\t\trole: 'button',\n\t\t\t\tread: false,\n\t\t\t\twrite: true,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate objectsLastRead: number | null = null;\n\tprivate objectCache: Record<string, ioBroker.Object> | null = null;\n\n\tprivate async getObjectsCachedAsync(): Promise<Record<string, ioBroker.Object>> {\n\t\tif (this.objectCache && this.objectsLastRead && Date.now() - this.objectsLastRead < 60 * 1000) {\n\t\t\treturn this.objectCache;\n\t\t}\n\n\t\tthis.objectsLastRead = Date.now();\n\t\tconst objResult = await this.getForeignObjects(`${this.namespace}.${GetDeviceFolderName()}.*`);\n\n\t\tthis.log.debug(`Read ${Object.keys(objResult).length} objects in ${Date.now() - this.objectsLastRead}ms.`);\n\n\t\t// Heh, this is a very subtle thing, but has quite a big impact on the integration tests:\n\t\t// Right now objects are pre-loaded on adapter start, if it is the first start (always the case in int-tests),\n\t\t// we get an empty array, which would be cached for a minute.\n\t\t// -> only write to cache if we find objects & invalidate cache on state creation.\n\t\tif (Object.keys(objResult).length > 0) {\n\t\t\tthis.objectCache = objResult;\n\t\t}\n\n\t\treturn objResult;\n\t}\n\n\tprivate async updateAllStates(): Promise<void> {\n\t\tconst startMs = Date.now();\n\t\tconst sem = new Semaphore(16);\n\t\tthis.log.debug(`Updating value of all states. Expecting ${this.stateNames.length} updates.`);\n\n\t\tconst promises = crossProduct(generationTypes, this.validDevices).map(([genType, device]) =>\n\t\t\tsem.with(() => this.simulateSingleDeviceStatesAsync(genType, device.name)),\n\t\t);\n\n\t\tconst updateCounts = await Promise.all(promises);\n\t\tconst totalUpdateCount = updateCounts.reduce((prev, curr) => prev + curr, 0);\n\n\t\tthis.log.info(`Updated/Simulated ${totalUpdateCount} states in ${Date.now() - startMs}ms. (Actual Count)`);\n\t}\n\n\tprivate async simulateSingleDeviceStatesAsync(\n\t\tgenType: ioBroker.DeviceStatesGenerationType,\n\t\tdeviceName: string,\n\t): Promise<number> {\n\t\tconst allStates = Object.values(this.stateLookup).filter(\n\t\t\tsd => sd.generationType === genType && sd.device.name === deviceName,\n\t\t);\n\t\tconst relevantStates = allStates.filter(sd => this.config.updateWriteableStates || sd.isReadOnly);\n\n\t\tconst handleSingleState = async (sd: ioBroker.DeviceStateDefinition): Promise<void> => {\n\t\t\tconst currentValue = await this.getStateAsync(sd.stateFqn);\n\t\t\tconst valueGen = sd.valueGenerator ?? getFallbackValueGenerator();\n\t\t\tconst nextValue = valueGen(sd, currentValue?.val);\n\n\t\t\tawait this.setState(sd.stateFqn, { val: nextValue, ack: true });\n\t\t};\n\n\t\tawait Promise.all(relevantStates.map(handleSingleState));\n\t\treturn relevantStates.length;\n\t}\n\n\tprivate async verifyCreatedDeviceAsync(deviceType: string): Promise<boolean> {\n\t\tconst objects = await this.getObjectsCachedAsync();\n\n\t\tconst deviceGenerationTypes: ioBroker.DeviceStatesGenerationType[] = ['all', 'required'];\n\n\t\tlet result = true;\n\t\tfor (const generationType of deviceGenerationTypes) {\n\t\t\tconst prefix = `${this.namespace}.${GetDeviceFolderName()}.${generationType}`;\n\n\t\t\tconst expectedId = `${prefix}.${deviceType}`;\n\n\t\t\tconst options: DetectOptions = {\n\t\t\t\tobjects: objects,\n\t\t\t\tid: expectedId,\n\t\t\t};\n\n\t\t\tconst controls = detector.detect(options);\n\n\t\t\tif (!controls) {\n\t\t\t\tthis.log.debug(`No matches found for ${options.id}`);\n\t\t\t\tresult = false;\n\t\t\t} else if (controls && controls.length > 1) {\n\t\t\t\tconst foundDeviceTypes = controls.map(c => c.type).join(', ');\n\t\t\t\tif (foundDeviceTypes.includes(deviceType)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.log.debug(\n\t\t\t\t\t`Too many matches found for ${options.id}, but none of them matches expected type '${deviceType}': [${foundDeviceTypes}]`,\n\t\t\t\t);\n\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate onUnload(callback: () => void): void {\n\t\ttry {\n\t\t\tthis.setConnected(false);\n\t\t} catch (error) {\n\t\t\tthis.log.error(`Unexpected error during unloading: ${(error as Error).message}`);\n\t\t} finally {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tprivate logMessages: string[] = [];\n\tprivate logLater(message: string): void {\n\t\tthis.logMessages.push(message);\n\t}\n\n\tprivate analyzeAllStates(allDevices: ioBroker.DeviceDefinition[]): void {\n\t\tconst mapState: (\n\t\t\tdevice: ioBroker.DeviceDefinition,\n\t\t\tstate: ExternalDetectorState,\n\t\t) => ioBroker.StateWithDeviceRef = (device, state) => ({ ...state, deviceRef: device });\n\n\t\tconst allStates = allDevices.reduce(\n\t\t\t(prev: ioBroker.StateWithDeviceRef[], curr) => [...prev, ...curr.states.map(s => mapState(curr, s))],\n\t\t\t[],\n\t\t);\n\n\t\tthis.logLater(`State count total: ${allStates.length}`);\n\n\t\tconst statesWithoutDefaultRole = allStates.filter(s => !s.defaultRole);\n\n\t\tif (statesWithoutDefaultRole.length > 0) {\n\t\t\tthis.logLater(\n\t\t\t\t`States without default role: ${statesWithoutDefaultRole.length} - [${statesWithoutDefaultRole.map(s => s.name).join(', ')}]`,\n\t\t\t);\n\n\t\t\tprintMissingDefaultRoleMarkdown(statesWithoutDefaultRole);\n\t\t}\n\t}\n\n\tprivate analyzeDuplicateDefaultRoles(allDevices: ioBroker.DeviceDefinition[]): void {\n\t\tconst isDuplicatedDefaultRole = (state: ExternalDetectorState, allStates: ExternalDetectorState[]): boolean => {\n\t\t\treturn allStates.filter(sInner => sInner.defaultRole == state.defaultRole).length > 1;\n\t\t};\n\n\t\tconst devicesWithDuplicateDefaultRoles = allDevices.filter(\n\t\t\td => d.states.filter(s => isDuplicatedDefaultRole(s, d.states)).length > 0,\n\t\t);\n\n\t\tif (devicesWithDuplicateDefaultRoles.length > 0) {\n\t\t\tconst deviceNamesWithDuplicateDefaultRoles = devicesWithDuplicateDefaultRoles.map(d => d.name);\n\t\t\tthis.logLater(\n\t\t\t\t`Found ${devicesWithDuplicateDefaultRoles.length} devices with duplicate default roles: [${deviceNamesWithDuplicateDefaultRoles.join(\n\t\t\t\t\t', ',\n\t\t\t\t)}] A state will be generated for each, ignoring the duplication.`,\n\t\t\t);\n\n\t\t\tfor (const device of devicesWithDuplicateDefaultRoles) {\n\t\t\t\tconst duplicatedDefaultRoles = device.states\n\t\t\t\t\t.filter(s => isDuplicatedDefaultRole(s, device.states))\n\t\t\t\t\t.map(s => `${s.name} -> ${s.defaultRole}`);\n\n\t\t\t\tthis.logLater(`\\t${device.name} -> Duplicate Roles: ${duplicatedDefaultRoles.join(', ')}`);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate setConnected(isConnected: boolean): void {\n\t\tvoid this.setState('info.connection', isConnected, true, error =>\n\t\t\t// analyse if the state could be set (because of permissions)\n\t\t\terror\n\t\t\t\t? this.log.error(`Can not update this._connected state: ${error}`)\n\t\t\t\t: this.log.debug(`connected set to ${isConnected}`),\n\t\t);\n\t}\n}\n\nclass Semaphore {\n\tprivate count: number;\n\tprivate queue: Array<() => void> = [];\n\n\tconstructor(maxConcurrency: number) {\n\t\tthis.count = maxConcurrency;\n\t}\n\n\tasync acquire(): Promise<void> {\n\t\tif (this.count > 0) {\n\t\t\tthis.count--;\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.queue.push(resolve);\n\t\t});\n\t}\n\n\trelease(): void {\n\t\tif (this.queue.length > 0) {\n\t\t\tconst next = this.queue.shift()!;\n\t\t\tnext();\n\t\t} else {\n\t\t\tthis.count++;\n\t\t}\n\t}\n\n\t// Convenience method\n\tasync with<T>(fn: () => Promise<T>): Promise<T> {\n\t\tawait this.acquire();\n\t\ttry {\n\t\t\treturn await fn();\n\t\t} finally {\n\t\t\tthis.release();\n\t\t}\n\t}\n}\n\nif (require.main !== module) {\n\t// Export the constructor in compact mode\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new TestDevices(options);\n} else {\n\t// otherwise start the instance directly\n\t(() => new TestDevices())();\n}\n"],
  "mappings": "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",
  "names": ["ChannelDetector"]
}
