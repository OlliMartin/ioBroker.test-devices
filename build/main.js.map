{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from '@iobroker/adapter-core';\nimport ChannelDetector, { type DetectOptions, type ExternalDetectorState } from '@iobroker/type-detector';\n\n// Heck, I can't get typescript to enforce that the array here consists of all properties of the type.\n// If a new type is introduced one line above, it must be added here too :/\nconst generationTypes: ioBroker.GenerationTypes = ['all', 'required'];\n\nconst deviceFilter: ioBroker.DeviceFilterType = {\n\tall: (_1, _2) => true,\n\trequired: (_, s) => !!s.required,\n};\n\nconst detector: ChannelDetector = new ChannelDetector();\n\nconst deviceTypeBlacklist: string[] = ['chart'];\n\nconst getDeviceMetadata: () => ioBroker.DeviceDefinition[] = () => {\n\tconst knownPatterns = ChannelDetector.getPatterns();\n\n\treturn Object.entries(knownPatterns)\n\t\t.filter(([k, _]) => !deviceTypeBlacklist.includes(k))\n\t\t.map(([k, v]) => ({\n\t\t\t...v,\n\t\t\tstates: v.states.filter(s => !!s.defaultRole),\n\t\t\tname: k,\n\t\t}));\n};\n\nconst getStateType = (state: ExternalDetectorState, fallback?: ioBroker.CommonType): ioBroker.CommonType => {\n\treturn Array.isArray(state.type) ? state.type[0] : (state.type ?? fallback ?? 'string');\n};\n\nconst crossProduct = <A, B>(as: readonly A[], bs: readonly B[]): Array<readonly [A, B]> => {\n\tconst result: Array<readonly [A, B]> = [];\n\tfor (const a of as) {\n\t\tfor (const b of bs) {\n\t\t\tresult.push([a, b] as const);\n\t\t}\n\t}\n\treturn result;\n};\n\nconst printMissingDefaultRoleMarkdown = (states: ioBroker.StateWithDeviceRef[]): void => {\n\tconst sortedStates = [...states] // Assuming sort is stable.\n\t\t.sort((a, b) => a.name.localeCompare(b.name))\n\t\t.sort((a, b) => a.deviceRef.name.localeCompare(b.deviceRef.name));\n\n\tlet output = '| Device | Name | Type | Role Regex |\\n';\n\toutput += '| - | - | - | - |\\n';\n\n\t/*                                                                                   *caugh* */\n\tfor (const state of sortedStates) {\n\t\toutput += `| ${state.deviceRef.name} | ${state.name} | ${getStateType(state, 'N/A' as any)} | \\`${state.role}\\` |\\n`;\n\t}\n\n\tconsole.log(output);\n};\n\nconst printMissingValueGenerators = (statesDefsByUnit: Record<string, ioBroker.DeviceStateDefinition[]>): void => {\n\tlet output = '| Unit | Value Type | Generation | Used By |\\n';\n\toutput += '| - | - | - |\\n';\n\n\tfor (const unit of Object.keys(statesDefsByUnit).sort()) {\n\t\tconst states = statesDefsByUnit[unit];\n\t\tconst typeDefs = [...new Set(states.map(s => s.commonType))];\n\n\t\tfor (const type of typeDefs.sort()) {\n\t\t\tconst usedBy = states\n\t\t\t\t.filter(s =>\n\t\t\t\t\tunit === 'N/A' ? !s.state.defaultUnit : s.state.defaultUnit === unit && s.commonType === type,\n\t\t\t\t)\n\t\t\t\t.map(ds => `${ds.device.name}.${ds.state.name}`);\n\n\t\t\toutput += `| ${unit} | ${type} | | ${usedBy.join(', ')} |\\n`;\n\t\t}\n\t}\n\n\tconsole.log(output);\n};\n\nconst getFallbackValueGenerator = (): ioBroker.ValueGenerator<ioBroker.StateValue> => {\n\treturn (sd, _) => {\n\t\tif (sd.commonType === 'number') {\n\t\t\treturn Math.random();\n\t\t}\n\t\tif (sd.commonType === 'string') {\n\t\t\treturn Math.random().toFixed(2);\n\t\t}\n\t\tif (sd.commonType === 'boolean') {\n\t\t\treturn Math.random() > 0.5;\n\t\t}\n\n\t\treturn Math.random();\n\t};\n};\n\nconst FallbackValueGenerator: ioBroker.ValueGenerator<string> = sd =>\n\t`${sd.device.name}.${sd.state.name}#${Math.random()}`;\n\nconst getToggleBoolValueGenerator = (): ioBroker.ValueGenerator<boolean> => {\n\treturn (_, val) => !val;\n};\n\nconst getNumberRangeGenerator = (min: number, max: number, decimals: number): ioBroker.ValueGenerator<number> => {\n\treturn (_1, _2) => {\n\t\treturn Number((Math.random() * (max - min) + min).toFixed(decimals));\n\t};\n};\n\nconst getRandomNumberGenerator = (): ioBroker.ValueGenerator<number> => {\n\treturn getNumberRangeGenerator(0, 20000, 2);\n};\n\nconst adjustType = <TIn extends ioBroker.StateValue, TOut extends ioBroker.StateValue>(\n\tinputValueGen: ioBroker.ValueGenerator<TIn>,\n\tconvert: (intermediate: TIn) => TOut,\n): ioBroker.ValueGenerator<TOut> => {\n\treturn (dsd, val) => convert(inputValueGen(dsd, val));\n};\n\nconst commonValueGenerators: ioBroker.ValueGeneratorDefinition[] = [\n\t{ u: '%', t: 'number', gen: getNumberRangeGenerator(0, 100, 2) },\n\t{ u: 'Hz', t: 'number', gen: getNumberRangeGenerator(5000, 15000, 0) },\n\t{ u: 'V', t: 'number', gen: getNumberRangeGenerator(80, 150, 1) },\n\t{ u: 'W', t: 'number', gen: getNumberRangeGenerator(20, 500, 0) },\n\t{ u: 'Wh', t: 'number', gen: getNumberRangeGenerator(20, 500, 0) },\n\t{ u: 'km/h', t: 'number', gen: getNumberRangeGenerator(5, 20, 2) },\n\t{ u: 'lux', t: 'number', gen: getRandomNumberGenerator() },\n\t{ u: 'mA', t: 'number', gen: getRandomNumberGenerator() },\n\t{ u: 'mbar', t: 'number', gen: getRandomNumberGenerator() },\n\t{ u: 'sec', t: 'number', gen: getNumberRangeGenerator(0, 300, 0) },\n\t{ u: '\u00B0', t: 'number', gen: getRandomNumberGenerator() },\n\n\t/* Longitude & Latidue */\n\t{ u: '\u00B0', t: 'number', /* d: 'location', */ s: ['LONGITUDE'], gen: getNumberRangeGenerator(-180, +180, 5) },\n\t{ u: '\u00B0', t: 'number', /* d: 'location', */ s: ['LATITUDE'], gen: getNumberRangeGenerator(-90, +90, 5) },\n\n\t{ u: '\u00B0', t: 'string', gen: adjustType(getRandomNumberGenerator(), num => num.toFixed(2)) },\n\t{ u: '\u00B0C', t: 'number', gen: getNumberRangeGenerator(-5, 35, 1) },\n\n\t{\n\t\tu: '%%CUSTOM%%',\n\t\tt: 'number',\n\t\td: ['rgb', 'rgbwSingle'],\n\t\ts: ['RED', 'GREEN', 'BLUE', 'WHITE'],\n\t\tgen: getNumberRangeGenerator(0, 255, 0),\n\t},\n\t{\n\t\tu: '%%CUSTOM%%',\n\t\tt: 'number',\n\t\td: ['rgb', 'rgbwSingle'],\n\t\ts: ['TEMPERATURE'],\n\t\tgen: getNumberRangeGenerator(0, 1000, 0),\n\t} /* I'm guessing Kelvin? What's the UOM here? */,\n\n\t{\n\t\tu: '%%CUSTOM%%',\n\t\tt: 'string',\n\t\ts: ['WORKING', 'ERROR'],\n\t\tgen: (sd, _) => (sd.state.name === 'WORKING' ? 'YES' : 'NO'),\n\t},\n\n\t{ u: '%%TYPE_MATCH%%', t: 'number', gen: getRandomNumberGenerator(), isFallback: true },\n\t{ u: '%%TYPE_MATCH%%', t: 'string', gen: FallbackValueGenerator, isFallback: true },\n\n\t/* Booleans can never be fallbacks */\n\t{\n\t\tu: '%%TYPE_MATCH%%',\n\t\tt: 'boolean',\n\t\tgen: getToggleBoolValueGenerator(),\n\t\tisFallback: false,\n\t},\n];\n\nconst getValueGeneratorRelevance = (vg: ioBroker.ValueGeneratorDefinition): number => {\n\tlet result = 0;\n\tif (vg.u !== '%%CUSTOM%%' && vg.u !== '%%TYPE_MATCH%%') {\n\t\tresult += 2;\n\t}\n\n\tif (vg.d) {\n\t\tresult += 3;\n\t}\n\n\tif (vg.s) {\n\t\tresult += 1;\n\t}\n\treturn result;\n};\n\nconst getValueGenerator = (\n\tstateDefinition: ioBroker.DeviceStateDefinition,\n): ioBroker.ValueGenerator<ioBroker.StateValue> | undefined => {\n\tconst logFallback = (sd: ioBroker.DeviceStateDefinition, vg: ioBroker.ValueGeneratorDefinition): void => {\n\t\tif (!vg.isFallback) {\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(`Warning: Fallback used for ${sd.device.name}:${sd.state.name} (${sd.commonType}).`);\n\t};\n\n\tconst exactGeneratorMatches = commonValueGenerators.filter(\n\t\tvgDef =>\n\t\t\tvgDef.u === stateDefinition.state.defaultUnit &&\n\t\t\tvgDef.t === stateDefinition.commonType &&\n\t\t\t(vgDef.d === undefined || vgDef.d.includes(stateDefinition.device.name)) &&\n\t\t\t(vgDef.s === undefined || vgDef.s.includes(stateDefinition.state.name)),\n\t);\n\n\tif (exactGeneratorMatches.length === 1) {\n\t\tlogFallback(stateDefinition, exactGeneratorMatches[0]);\n\t\treturn exactGeneratorMatches[0].gen;\n\t} else if (exactGeneratorMatches.length > 1) {\n\t\tconst genWithHighestSpecification = exactGeneratorMatches.sort(\n\t\t\t(a, b) => getValueGeneratorRelevance(b) - getValueGeneratorRelevance(a),\n\t\t);\n\n\t\treturn genWithHighestSpecification[0].gen;\n\t}\n\n\tconst customMatches = commonValueGenerators.filter(\n\t\tvgDef =>\n\t\t\tvgDef.u === '%%CUSTOM%%' &&\n\t\t\tvgDef.t === stateDefinition.commonType &&\n\t\t\t(vgDef.d === undefined || vgDef.d.includes(stateDefinition.device.name)) &&\n\t\t\t(vgDef.s === undefined || vgDef.s.includes(stateDefinition.state.name)),\n\t);\n\n\tif (customMatches.length === 1) {\n\t\tlogFallback(stateDefinition, customMatches[0]);\n\t\treturn customMatches[0].gen;\n\t}\n\n\tconst typeMatches = commonValueGenerators.filter(\n\t\tvgDef => vgDef.u === '%%TYPE_MATCH%%' && vgDef.t === stateDefinition.commonType,\n\t);\n\n\tif (typeMatches.length === 1) {\n\t\tlogFallback(stateDefinition, typeMatches[0]);\n\t\treturn typeMatches[0].gen;\n\t}\n\n\treturn undefined;\n};\n\nclass TestDevices extends utils.Adapter {\n\tprivate static deviceFolderName: string = 'devices';\n\tprivate static triggerFolderName: string = 'triggers';\n\n\tprivate readonly validDevices: ioBroker.DeviceDefinition[];\n\tprivate readonly stateLookup: Record<string, ioBroker.DeviceStateDefinition>;\n\n\tprivate readonly stateNames: string[] = [];\n\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\tname: 'test-devices',\n\t\t});\n\t\tthis.on('message', this.onMessage.bind(this));\n\t\tthis.on('ready', this.onReady.bind(this));\n\t\tthis.on('stateChange', this.onStateChange.bind(this));\n\t\tthis.on('unload', this.onUnload.bind(this));\n\n\t\tconst startMs = Date.now();\n\t\tconst allDevices = getDeviceMetadata();\n\n\t\tthis.analyzeAllStates(allDevices);\n\n\t\tconst deviceNamesWithMissingDefaultRoles = this.getDeviceNamesMissingDefaultRoles(allDevices);\n\t\tthis.analyzeDuplicateDefaultRoles(allDevices);\n\n\t\tthis.validDevices = allDevices.filter(d => !deviceNamesWithMissingDefaultRoles.includes(d.name));\n\n\t\tthis.stateLookup = this.createDesiredStateDefinitions(this.validDevices);\n\t\tthis.stateNames = Object.keys(this.stateLookup);\n\n\t\tthis.logLater(`Discovering desired states took ${Date.now() - startMs}ms.`);\n\n\t\tconst missingValueGenerators: Record<string, ioBroker.DeviceStateDefinition[]> = Object.values(this.stateLookup)\n\t\t\t.filter(s => s.isReadOnly)\n\t\t\t.filter(s => !getValueGenerator(s))\n\t\t\t.reduce((prev: Record<string, ioBroker.DeviceStateDefinition[]>, curr) => {\n\t\t\t\tconst unitSafe = curr.state.defaultUnit ?? 'N/A';\n\n\t\t\t\tif (Object.hasOwnProperty.call(prev, unitSafe)) {\n\t\t\t\t\tprev[unitSafe].push(curr);\n\t\t\t\t} else {\n\t\t\t\t\tprev[unitSafe] = [curr];\n\t\t\t\t}\n\n\t\t\t\treturn prev;\n\t\t\t}, {});\n\n\t\tif (Object.keys(missingValueGenerators).length > 0) {\n\t\t\tthis.logLater(`There are missing value generators.`);\n\t\t\tprintMissingValueGenerators(missingValueGenerators);\n\t\t}\n\n\t\tconst triggerChangeRegex = `^${this.namespace.replace('.', '\\\\.')}\\\\.${TestDevices.GetTriggerFolderName()}\\\\.((${generationTypes.join('|')})\\\\.([^\\\\.]*))$`;\n\t\tthis.logLater(`Constructed trigger change regex: ${triggerChangeRegex}`);\n\n\t\tconst deviceChangeRegex = `^${this.namespace}\\\\.${TestDevices.GetDeviceFolderName()}\\\\.(${generationTypes.join('|')})\\\\.([^\\\\.]*)\\\\.([^\\\\.]*)$`;\n\t\tthis.logLater(`Constructed device change regex: ${deviceChangeRegex}`);\n\n\t\tthis.triggerChangeRegex = new RegExp(triggerChangeRegex);\n\t\tthis.deviceStateChangeRegex = new RegExp(deviceChangeRegex);\n\t}\n\n\tprivate createDesiredStateDefinitions(\n\t\tvalidDevices: ioBroker.DeviceDefinition[],\n\t): Record<string, ioBroker.DeviceStateDefinition> {\n\t\tconst getDeviceType = (genType: ioBroker.DeviceStatesGenerationType): string =>\n\t\t\t`${this.namespace}.${TestDevices.GetDeviceFolderName()}.${genType}`;\n\t\tconst getDeviceRoot = (\n\t\t\tgenType: ioBroker.DeviceStatesGenerationType,\n\t\t\tdevice: ioBroker.DeviceDefinition,\n\t\t): string => `${getDeviceType(genType)}.${device.name}`;\n\n\t\t// 'NoOp' for now\n\t\tconst getFilterContext = (device: ioBroker.DeviceDefinition): ioBroker.DeviceFilterContext => {\n\t\t\treturn { device, config: this.config };\n\t\t};\n\n\t\tconst isReadOnly = (state: ExternalDetectorState): boolean =>\n\t\t\t(!!state.read || state.read === undefined) && !state.write;\n\n\t\tconst stateCacheMemory: ioBroker.DeviceStateDefinition[] = crossProduct(generationTypes, validDevices)\n\t\t\t.map(arr => ({\n\t\t\t\tgenerationType: arr[0],\n\t\t\t\tdevice: arr[1],\n\t\t\t}))\n\t\t\t.map(m => ({\n\t\t\t\t...m,\n\t\t\t\tcontext: getFilterContext(m.device),\n\t\t\t\tdeviceType: getDeviceType(m.generationType),\n\t\t\t\tdeviceRoot: getDeviceRoot(m.generationType, m.device),\n\t\t\t}))\n\t\t\t.map(m =>\n\t\t\t\tm.device.states\n\t\t\t\t\t.filter(s => deviceFilter[m.generationType](m.context, s))\n\t\t\t\t\t.map(s => ({\n\t\t\t\t\t\t...m,\n\t\t\t\t\t\tstate: s,\n\t\t\t\t\t\tread: s.read ?? true,\n\t\t\t\t\t\twrite: s.write ?? false,\n\t\t\t\t\t\tstateFqn: `${m.deviceRoot}.${s.name}`,\n\t\t\t\t\t\tcommonType: getStateType(s),\n\t\t\t\t\t\tisReadOnly: isReadOnly(s),\n\t\t\t\t\t\tvalueGenerator: undefined,\n\t\t\t\t\t})),\n\t\t\t)\n\t\t\t.reduce((prev, curr) => [...prev, ...curr], [])\n\t\t\t.map(sd => ({\n\t\t\t\t...sd,\n\t\t\t\tvalueGenerator: getValueGenerator(sd) ?? getFallbackValueGenerator(),\n\t\t\t}));\n\n\t\treturn stateCacheMemory.reduce((prev, curr) => ({ ...prev, [curr.stateFqn]: curr }), {});\n\t}\n\n\tpublic static GetDeviceFolderName(): string {\n\t\treturn TestDevices.deviceFolderName;\n\t}\n\n\tpublic static GetTriggerFolderName(): string {\n\t\treturn TestDevices.triggerFolderName;\n\t}\n\n\tprivate async onReady(): Promise<void> {\n\t\tfor (const msg of this.logMessages) {\n\t\t\tthis.log.info(msg);\n\t\t}\n\t\tthis.logMessages = [];\n\n\t\tconst startMs = Date.now();\n\n\t\tconst objectCache = await this.getObjectsCachedAsync();\n\n\t\tawait this.createTopLevelFoldersAsync();\n\t\tawait this.createDeviceChangeTriggersAsync(this.validDevices);\n\t\tawait this.createMetaStatesForDevicesAsync(this.validDevices);\n\n\t\tconst foundInDb = Object.keys(objectCache);\n\t\tif (this.stateNames.every(requestedDeviceStateName => foundInDb.includes(requestedDeviceStateName))) {\n\t\t\tthis.log.debug(\n\t\t\t\t`Device states unchanged from last start. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Skipping creation.`,\n\t\t\t);\n\t\t} else {\n\t\t\tthis.log.debug(\n\t\t\t\t`Actual device states deviate from desired state. Want: ${this.stateNames.length} Have: ${foundInDb.length}. Recreating all.`,\n\t\t\t);\n\t\t\tawait this.createAllDevicesAsync(this.validDevices);\n\t\t\tthis.objectCache = null; // Force cache reload for good measure\n\t\t\tvoid this.getObjectsCachedAsync();\n\t\t}\n\n\t\tthis.log.info(`Stored state count: ${this.stateNames.length}.`);\n\n\t\tthis.setConnected(true);\n\t\tthis.log.info(`Start-up finished within ${Date.now() - startMs}ms.`);\n\n\t\tthis.subscribeStates(`${this.namespace}.*`);\n\t}\n\n\tprivate readonly validCommands: string[] = ['VERIFY_DEVICE_TYPE', 'GET_DEVICE_STATES'];\n\n\tprivate readonly triggerChangeRegex: RegExp;\n\tprivate readonly deviceStateChangeRegex: RegExp;\n\tprivate readonly setReadOnlyStatesOnly: boolean = false; // TODO OMA 2026-01-10: Read from config?\n\tprivate async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n\t\tif (!state || state.ack) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.triggerChangeRegex.test(id)) {\n\t\t\tconst startMs = Date.now();\n\t\t\tconst match = this.triggerChangeRegex.exec(id);\n\t\t\tif (!match || match.length < 4) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst genType = match[2];\n\t\t\tconst device = match[3];\n\n\t\t\tconst allStates = Object.values(this.stateLookup).filter(\n\t\t\t\tsd => sd.generationType === genType && sd.device.name === device,\n\t\t\t);\n\t\t\tconst relevantStates = allStates.filter(sd => !this.setReadOnlyStatesOnly || sd.isReadOnly);\n\n\t\t\tthis.log.debug(\n\t\t\t\t`Received trigger for ${id} -> ${genType}:${device}. ${relevantStates.length} out of ${allStates.length} are relevant (read only).`,\n\t\t\t);\n\n\t\t\tconst handleSingleState = async (sd: ioBroker.DeviceStateDefinition): Promise<void> => {\n\t\t\t\tconst currentValue = await this.getStateAsync(sd.stateFqn);\n\t\t\t\tconst valueGen = sd.valueGenerator ?? getFallbackValueGenerator();\n\t\t\t\tconst nextValue = valueGen(sd, currentValue?.val);\n\n\t\t\t\tawait this.setState(sd.stateFqn, { val: nextValue, ack: true });\n\t\t\t};\n\n\t\t\tawait Promise.all(relevantStates.map(handleSingleState));\n\n\t\t\t// ACK\n\t\t\tawait this.setState(id, state, true);\n\t\t\tthis.log.debug(`Trigger processed in ${Date.now() - startMs}ms.`);\n\t\t}\n\n\t\tif (this.deviceStateChangeRegex.test(id)) {\n\t\t\tthis.log.debug(`Received state change for device ${id}.`);\n\t\t\tawait this.setState(id, state, true);\n\t\t}\n\t}\n\n\tprivate async onMessage(message: ioBroker.Message): Promise<void> {\n\t\tif (!this.validCommands.includes(message.command) || !message.callback) {\n\t\t\tthis.log.info(`Dropping unknown command '${message.command}'.`);\n\t\t\tthis.sendTo(message.from, message.command, 'INVALID_COMMAND', message.callback);\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.command === 'VERIFY_DEVICE_TYPE') {\n\t\t\tconst deviceType = message.message as string;\n\t\t\tconst result = await this.verifyCreatedDeviceAsync(deviceType);\n\t\t\tthis.sendTo(message.from, message.command, result ? 'SUCCESS' : 'FAIL', message.callback);\n\t\t} else if (message.command === 'GET_DEVICE_STATES') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t\tthis.sendTo(message.from, message.command, this.stateNames, message.callback);\n\t\t} else if (message.command === 'SIMULATE_SINGLE_DEVICE_CHANGE') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t} else if (message.command === 'SIMULATE_DEVICE_CHANGES') {\n\t\t\tthis.log.debug('Collecting device states.');\n\t\t}\n\t}\n\n\tprivate async createTopLevelFoldersAsync(): Promise<void> {\n\t\tconst fqFolderName = `${this.namespace}.${TestDevices.GetDeviceFolderName()}`;\n\t\tconst fqTriggerName = `${this.namespace}.${TestDevices.GetTriggerFolderName()}`;\n\n\t\tawait Promise.allSettled([\n\t\t\tthis.extendObject(fqTriggerName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqTriggerName,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tthis.extendObject(fqFolderName, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: fqFolderName,\n\t\t\t\t},\n\t\t\t}),\n\t\t]);\n\t}\n\n\tprivate async createAllDevicesAsync(validDevices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tconst startMs = Date.now();\n\t\tthis.log.debug(`Creating ${this.stateNames.length} states for ${validDevices.length} devices`);\n\t\tconst sem = new Semaphore(16);\n\n\t\tconst allPromises = Object.values(this.stateLookup).map(stateDef =>\n\t\t\tsem.with(() =>\n\t\t\t\tthis.extendObject(stateDef.stateFqn, {\n\t\t\t\t\ttype: 'state',\n\t\t\t\t\tcommon: {\n\t\t\t\t\t\tname: stateDef.state.name,\n\t\t\t\t\t\ttype: stateDef.commonType,\n\t\t\t\t\t\tread: stateDef.read,\n\t\t\t\t\t\twrite: stateDef.write,\n\t\t\t\t\t\trole: stateDef.state.defaultRole,\n\t\t\t\t\t\tunit: stateDef.state.defaultUnit,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\n\t\tawait Promise.all(allPromises);\n\t\tthis.log.info(\n\t\t\t`Created ${this.stateNames.length} states for ${validDevices.length} devices in ${Date.now() - startMs}ms.`,\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDevicesAsync(devices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tawait Promise.all(\n\t\t\tcrossProduct(generationTypes, devices).map(d => this.createMetaStatesForDeviceAsync(d[1], d[0])),\n\t\t);\n\t}\n\n\tprivate async createMetaStatesForDeviceAsync(\n\t\tdevice: ioBroker.DeviceDefinition,\n\t\tprefix: ioBroker.DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${TestDevices.GetDeviceFolderName()}.${prefix}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'device',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\n\t\tconst deviceRoot = `${deviceType}.${device.name}`;\n\t\tawait this.extendObject(deviceRoot, {\n\t\t\ttype: 'channel',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate async createDeviceChangeTriggersAsync(validDevices: ioBroker.DeviceDefinition[]): Promise<void> {\n\t\tthis.log.debug(`Creating triggers for ${validDevices.length} devices`);\n\n\t\tconst startMs = Date.now();\n\t\tconst triggerFolder = `${this.namespace}.${TestDevices.GetTriggerFolderName()}`;\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tawait this.extendObject(`${triggerFolder}.${generationType}`, {\n\t\t\t\ttype: 'folder',\n\t\t\t\tcommon: {\n\t\t\t\t\tname: generationType,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfor (const generationType of generationTypes) {\n\t\t\tfor (const device of validDevices) {\n\t\t\t\tawait this.createOrUpdateSingleDeviceTriggerAsync(\n\t\t\t\t\tdevice,\n\t\t\t\t\tTestDevices.GetTriggerFolderName(),\n\t\t\t\t\tgenerationType,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.info(`Done. Created ${validDevices.length} device triggers in ${Date.now() - startMs}ms.`);\n\t}\n\n\tprivate async createOrUpdateSingleDeviceTriggerAsync(\n\t\tdevice: ioBroker.DeviceDefinition,\n\t\tfolderName: string,\n\t\tprefix: ioBroker.DeviceStatesGenerationType,\n\t): Promise<void> {\n\t\tconst deviceType = `${this.namespace}.${folderName}.${prefix}.${device.name}`;\n\t\tawait this.extendObject(deviceType, {\n\t\t\ttype: 'state',\n\t\t\tcommon: {\n\t\t\t\tname: device.name,\n\t\t\t\ttype: 'boolean',\n\t\t\t\trole: 'button',\n\t\t\t\tread: false,\n\t\t\t\twrite: true,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate objectsLastRead: number | null = null;\n\tprivate objectCache: Record<string, ioBroker.Object> | null = null;\n\n\tprivate async getObjectsCachedAsync(): Promise<Record<string, ioBroker.Object>> {\n\t\tif (this.objectCache && this.objectsLastRead && Date.now() - this.objectsLastRead < 60 * 1000) {\n\t\t\treturn this.objectCache;\n\t\t}\n\n\t\tthis.objectsLastRead = Date.now();\n\t\tconst objResult = await this.getForeignObjects(`${this.namespace}.${TestDevices.GetDeviceFolderName()}.*`);\n\n\t\tthis.log.debug(`Read ${Object.keys(objResult).length} objects in ${Date.now() - this.objectsLastRead}ms.`);\n\n\t\t// Heh, this is a very subtle thing, but has quite a big impact on the integration tests:\n\t\t// Right now objects are pre-loaded on adapter start, if it is the first start (always the case in int-tests),\n\t\t// we get an empty array, which would be cached for a minute.\n\t\t// -> only write to cache if we find objects & invalidate cache on state creation.\n\t\tif (Object.keys(objResult).length > 0) {\n\t\t\tthis.objectCache = objResult;\n\t\t}\n\n\t\treturn objResult;\n\t}\n\n\tprivate async verifyCreatedDeviceAsync(deviceType: string): Promise<boolean> {\n\t\tconst objects = await this.getObjectsCachedAsync();\n\n\t\tconst deviceGenerationTypes: ioBroker.DeviceStatesGenerationType[] = ['all', 'required'];\n\n\t\tlet result = true;\n\t\tfor (const generationType of deviceGenerationTypes) {\n\t\t\tconst prefix = `${this.namespace}.${TestDevices.GetDeviceFolderName()}.${generationType}`;\n\n\t\t\tconst expectedId = `${prefix}.${deviceType}`;\n\n\t\t\tconst options: DetectOptions = {\n\t\t\t\tobjects: objects,\n\t\t\t\tid: expectedId,\n\t\t\t};\n\n\t\t\tconst controls = detector.detect(options);\n\n\t\t\tif (!controls) {\n\t\t\t\tthis.log.debug(`No matches found for ${options.id}`);\n\t\t\t\tresult = false;\n\t\t\t} else if (controls && controls.length > 1) {\n\t\t\t\tconst foundDeviceTypes = controls.map(c => c.type).join(', ');\n\t\t\t\tif (foundDeviceTypes.includes(deviceType)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.log.debug(\n\t\t\t\t\t`Too many matches found for ${options.id}, but none of them matches expected type '${deviceType}': [${foundDeviceTypes}]`,\n\t\t\t\t);\n\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate onUnload(callback: () => void): void {\n\t\ttry {\n\t\t\tthis.setConnected(false);\n\t\t} catch (error) {\n\t\t\tthis.log.error(`Unexpected error during unloading: ${(error as Error).message}`);\n\t\t} finally {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tprivate logMessages: string[] = [];\n\tprivate logLater(message: string): void {\n\t\tthis.logMessages.push(message);\n\t}\n\n\tprivate analyzeAllStates(allDevices: ioBroker.DeviceDefinition[]): void {\n\t\tconst mapState: (\n\t\t\tdevice: ioBroker.DeviceDefinition,\n\t\t\tstate: ExternalDetectorState,\n\t\t) => ioBroker.StateWithDeviceRef = (device, state) => ({ ...state, deviceRef: device });\n\n\t\tconst allStates = allDevices.reduce(\n\t\t\t(prev: ioBroker.StateWithDeviceRef[], curr) => [...prev, ...curr.states.map(s => mapState(curr, s))],\n\t\t\t[],\n\t\t);\n\n\t\tthis.logLater(`State count total: ${allStates.length}`);\n\n\t\tconst statesWithoutDefaultRole = allStates.filter(s => !s.defaultRole);\n\n\t\tif (statesWithoutDefaultRole.length > 0) {\n\t\t\tthis.logLater(\n\t\t\t\t`States without default role: ${statesWithoutDefaultRole.length} - [${statesWithoutDefaultRole.map(s => s.name).join(', ')}]`,\n\t\t\t);\n\n\t\t\tprintMissingDefaultRoleMarkdown(statesWithoutDefaultRole);\n\t\t}\n\t}\n\n\tprivate analyzeDuplicateDefaultRoles(allDevices: ioBroker.DeviceDefinition[]): void {\n\t\tconst isDuplicatedDefaultRole = (state: ExternalDetectorState, allStates: ExternalDetectorState[]): boolean => {\n\t\t\treturn allStates.filter(sInner => sInner.defaultRole == state.defaultRole).length > 1;\n\t\t};\n\n\t\tconst devicesWithDuplicateDefaultRoles = allDevices.filter(\n\t\t\td => d.states.filter(s => isDuplicatedDefaultRole(s, d.states)).length > 0,\n\t\t);\n\n\t\tif (devicesWithDuplicateDefaultRoles.length > 0) {\n\t\t\tconst deviceNamesWithDuplicateDefaultRoles = devicesWithDuplicateDefaultRoles.map(d => d.name);\n\t\t\tthis.logLater(\n\t\t\t\t`Found ${devicesWithDuplicateDefaultRoles.length} devices with duplicate default roles: [${deviceNamesWithDuplicateDefaultRoles.join(\n\t\t\t\t\t', ',\n\t\t\t\t)}] A state will be generated for each, ignoring the duplication.`,\n\t\t\t);\n\n\t\t\tfor (const device of devicesWithDuplicateDefaultRoles) {\n\t\t\t\tconst duplicatedDefaultRoles = device.states\n\t\t\t\t\t.filter(s => isDuplicatedDefaultRole(s, device.states))\n\t\t\t\t\t.map(s => `${s.name} -> ${s.defaultRole}`);\n\n\t\t\t\tthis.logLater(`\\t${device.name} -> Duplicate Roles: ${duplicatedDefaultRoles.join(', ')}`);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getDeviceNamesMissingDefaultRoles(allDevices: ioBroker.DeviceDefinition[]): string[] {\n\t\tconst devicesWithMissingDefaultRoles = allDevices.filter(\n\t\t\td => d.states.filter(s => s.required && !s.defaultRole).length > 0,\n\t\t);\n\n\t\tconst deviceNamesWithMissingDefaultRoles = devicesWithMissingDefaultRoles.map(d => d.name);\n\n\t\tif (devicesWithMissingDefaultRoles.length > 0) {\n\t\t\tthis.logLater(\n\t\t\t\t`Found ${devicesWithMissingDefaultRoles.length} devices with missing default roles: [${deviceNamesWithMissingDefaultRoles.join(\n\t\t\t\t\t', ',\n\t\t\t\t)}] These will be skipped.`,\n\t\t\t);\n\t\t}\n\n\t\treturn deviceNamesWithMissingDefaultRoles;\n\t}\n\n\tprivate setConnected(isConnected: boolean): void {\n\t\tvoid this.setState('info.connection', isConnected, true, error =>\n\t\t\t// analyse if the state could be set (because of permissions)\n\t\t\terror\n\t\t\t\t? this.log.error(`Can not update this._connected state: ${error}`)\n\t\t\t\t: this.log.debug(`connected set to ${isConnected}`),\n\t\t);\n\t}\n}\n\nclass Semaphore {\n\tprivate count: number;\n\tprivate queue: Array<() => void> = [];\n\n\tconstructor(maxConcurrency: number) {\n\t\tthis.count = maxConcurrency;\n\t}\n\n\tasync acquire(): Promise<void> {\n\t\tif (this.count > 0) {\n\t\t\tthis.count--;\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tthis.queue.push(resolve);\n\t\t});\n\t}\n\n\trelease(): void {\n\t\tif (this.queue.length > 0) {\n\t\t\tconst next = this.queue.shift()!;\n\t\t\tnext();\n\t\t} else {\n\t\t\tthis.count++;\n\t\t}\n\t}\n\n\t// Convenience method\n\tasync with<T>(fn: () => Promise<T>): Promise<T> {\n\t\tawait this.acquire();\n\t\ttry {\n\t\t\treturn await fn();\n\t\t} finally {\n\t\t\tthis.release();\n\t\t}\n\t}\n}\n\nif (require.main !== module) {\n\t// Export the constructor in compact mode\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new TestDevices(options);\n} else {\n\t// otherwise start the instance directly\n\t(() => new TestDevices())();\n}\n"],
  "mappings": "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",
  "names": ["ChannelDetector"]
}
